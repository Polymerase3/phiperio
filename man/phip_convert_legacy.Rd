% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/convert-legacy.R
\name{phip_convert_legacy}
\alias{phip_convert_legacy}
\title{Convert legacy Carlos-style input to a modern \strong{phip_data} object}
\usage{
phip_convert_legacy(
  exist_file = NULL,
  fold_change_file = NULL,
  samples_file = NULL,
  input_file = NULL,
  hit_file = NULL,
  timepoints_file = NULL,
  extra_cols = NULL,
  output_dir = NULL,
  peptide_library = TRUE,
  n_cores = 8,
  materialise_table = TRUE,
  config_yaml = NULL
)
}
\arguments{
\item{exist_file}{Path to the \strong{exist} CSV (peptide x sample binary
matrix). \emph{Required unless given in \code{config_yaml}.}}

\item{fold_change_file}{Path to the \strong{fold_change} CSV (peptide x
sample numeric matrix). \emph{Required unless given in \code{config_yaml}.}}

\item{samples_file}{Path to the \strong{samples} CSV (sample metadata).
\emph{Required unless given in \code{config_yaml}.}}

\item{input_file, hit_file}{Paths to the \strong{raw_counts} CSV (peptide x
sample integer matrix). \emph{Required unless given in \code{config_yaml}.}}

\item{timepoints_file}{Path to the \strong{timepoints} CSV (subject <-> sample
mapping). Optional for cross-sectional data.}

\item{extra_cols}{Character vector of extra metadata columns to retain.}

\item{output_dir}{\emph{Deprecated.} Ignored with a warning.}

\item{peptide_library}{logical, defining if the \code{peptide_library} is to be
downloaded from the official \code{phiperio} GitHub}

\item{n_cores}{Integer >= 1. Number of CPU threads DuckDB may use while
reading and writing files.}

\item{materialise_table}{Logical. If \code{FALSE} the result is registered as a
\strong{view}; if \code{TRUE} the table is fully \strong{materialised} and stored on disk,
trading higher load time and storage for faster repeated queries.}

\item{config_yaml}{Optional YAML file containing any of the above
parameters (see example).}
}
\value{
A validated \code{phip_data} object whose \code{data_long} slot is backed by a
DuckDB connection.
}
\description{
\code{phip_convert_legacy()} ingests the original three-file PhIP-Seq input
(binary \emph{exist} matrix, \emph{samples} metadata, optional \emph{timepoints} map).
Paths can be supplied directly or via a single YAML config; explicit
arguments always override the YAML.  The function normalises the chosen
DuckDB storage, validates every file, and returns a ready-to-use
\code{phip_data} object.
}
\details{
Input files are validated in two stages:
\itemize{
\item \strong{Fast-fail} checks (paths, extensions, and required arguments) run during
path resolution.
\item \strong{Data validation} (required columns, uniqueness, value ranges, etc.) is
centralized in \code{validate_phip_data()}.
}
}
\examples{
\dontrun{
## 1. Direct-path usage
pd <- phip_convert_legacy(
  exist_file = "legacy/exist.csv",
  samples_file = "legacy/samples.csv",
  timepoints_file = "legacy/timepoints.csv",
)

## 2. YAML-driven usage (explicit args override YAML)
# --- config/legacy_config.yaml ---
# exist_file:       data/exist.csv
# samples_file:     meta/samples.csv
# timepoints_file:  meta/timepoints.csv
# extra_cols: [sex, age]
# -------------------------------

pd <- phip_convert_legacy(
  config_yaml = "config/legacy_config.yaml"
)
}

}
